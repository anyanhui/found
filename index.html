<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="css/common.css"/>
   <script src="js/mui.min.js" charset="UTF-8"></script>
	<script type="text/javascript" charset="UTF-8">
		mui.init({
			swipeBack:false
		});
		
		var mainWebview;
		var curBarItemWebview;
		
		var barItemWebviewArray = [];
		var barItemArray = ['barItem/home.html','barItem/compass.html','barItem/message.html','barItem/mine.html'];
		mui.plusReady(function(){
			//获取当前title和当前webview
			mainWebview = plus.webview.currentWebview();
			plus.navigator.setStatusBarBackground( "#41cea9" );
			//设置只支持竖屏幕显示
			plus.screen.lockOrientation("portrait-primary");
			//初始化与index有关的页面
			initIndexView();
			
		});
		
		
		//初始化
		function initIndexView(){
			//初始化所有bar页面
			inittabitemWebviews();
			//添加bar点击事件接受
			tapBaritem();
		}
		
		
		//初始化所有bar页面
		function inittabitemWebviews(){
			for (var i = 0; i < barItemArray.length; i++) {
				barItemWebviewArray[i] = mui.preload({
					id:barItemArray[i],
					url:barItemArray[i],
					styles:{
						top:'0px',
						bottom: '51px',
						left: '0px',
						bounce: 'vertical',
						bounceBackground: '#f8f8f8'
					},
					waiting:{
						autoShow:false
					}
				});
				barItemWebviewArray[i].hide();
				mainWebview.append(barItemWebviewArray[i]);
			}
			barItemWebviewArray[0].show();
			curBarItemWebview = barItemWebviewArray[0];
		}
		
		
		//添加点击事件
		function tapBaritem(){
			mui('.mui-bar-tab').on('tap','.mui-tab-item',function(){
				var baritem = this;
				var baritemurl = baritem.getAttribute('href'); 
				if(baritemurl == "barItem/public.html"){
					 mui.openWindow({
						url:'barItem/public.html',
						show:{
					      aniShow:"slide-in-bottom",//页面显示动画，默认为”slide-in-right“；
					      duration:500//页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒；
					    },
					});
					return;
				}
				
//				indexof()如果为false返回－1所以前面加上~
				if (!~curBarItemWebview.getURL().indexOf(baritemurl)) {
					for (var i = 0; i < barItemArray.length; i++) {
						if (barItemArray[i] == baritemurl) {
							//更改头部名字
							//切换baritemwebview
							barItemWebviewArray[i].show();
							curBarItemWebview = barItemWebviewArray[i];
							break;
						}
					}
				}
			});
			
			 mui.preload({
					id:'public.html',
					url:'barItem/public.html',
					styles:{
						top:'0px',
						bottom:'0px'
					}
				});
			
		}
		
		
		
	</script>
</head>
<body>
	<nav class="mui-bar mui-bar-tab">
		<a class="mui-tab-item mui-active" href="barItem/home.html">
			<span class="mui-icon mui-icon-home"></span>
			<span class="mui-tab-label">首页</span>
		</a>
		<a class="mui-tab-item" href="barItem/compass.html">
			<span class="mui-icon mui-icon-paperplane"></span>
			<span class="mui-tab-label">发现</span>
		</a>
		<a class="mui-tab-item" href="barItem/public.html">
			<span class="mui-icon mui-icon-camera"></span>
			<span class="mui-tab-label">发布</span>
		</a>
		<a class="mui-tab-item" href="barItem/message.html">
			<span class="mui-icon mui-icon-chatbubble"></span>
			<span class="mui-tab-label">消息</span>
		</a>
		<a class="mui-tab-item" href="barItem/mine.html">
			<span class="mui-icon mui-icon-person"></span>
			<span class="mui-tab-label">我的</span>
		</a>
	</nav>
</body>
</html>